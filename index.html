<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Golf Anmeldung Übersicht</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 10px;
}

h2 {
    text-align: center;
}

button {
    padding: 10px;
    margin: 5px 0;
    font-size: 16px;
}

.table-container {
    overflow-x: auto;
}

table {
    border-collapse: collapse;
    width: 100%;
    min-width: 900px;
}

th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
    font-size: 14px;
}

th {
    background-color: #f2f2f2;
}

@media (max-width: 768px) {
    th, td {
        font-size: 12px;
        padding: 4px;
    }
}
</style>
</head>
<body>

<h2>Golf Anmeldung Übersicht</h2>

<input type="file" id="fileInput" accept=".csv">
<br>
<button onclick="exportTable()">Als XLS exportieren</button>

<div class="table-container">
    <table id="dataTable"></table>
</div>

<script>
let tableData = [];

document.getElementById('fileInput').addEventListener('change', handleFile);

function handleFile(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(event) {
        const text = event.target.result;
        parseCSV(text);
        renderTable();
    };

    reader.readAsText(file, 'UTF-8');
}

function parseCSV(text) {
    const rows = text.trim().split(/\r?\n/);

    tableData = rows.map(row =>
        row.split(';').map(cell => cell.trim())
    );

    if (tableData.length <= 1) return;

    const header = tableData[0];
    const body = tableData.slice(1);

    body.sort((a, b) => {
        const dateA = convertToDate(a[0]);
        const dateB = convertToDate(b[0]);
        return dateA - dateB;
    });

    tableData = [header, ...body];
}

function convertToDate(dateStr) {
    // Erwartet Format dd.mm.yyyy
    if (!dateStr) return new Date(0);

    const parts = dateStr.split('.');
    if (parts.length !== 3) return new Date(0);

    return new Date(
        parseInt(parts[2]),
        parseInt(parts[1]) - 1,
        parseInt(parts[0])
    );
}

function renderTable() {
    const table = document.getElementById('dataTable');
    table.innerHTML = '';

    if (tableData.length === 0) {
        table.innerHTML = '<tr><td>Keine Daten geladen</td></tr>';
        return;
    }

    tableData.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');

        row.forEach(cell => {
            const element = document.createElement(rowIndex === 0 ? 'th' : 'td');
            element.textContent = cell;
            tr.appendChild(element);
        });

        table.appendChild(tr);
    });
}

function exportTable() {
    if (tableData.length === 0) {
        alert("Keine Daten zum Exportieren geladen.");
        return;
    }

    const ws = XLSX.utils.aoa_to_sheet(tableData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Golf");
    XLSX.writeFile(wb, "Golf_Anmeldungen.xlsx");
}
</script>


</body>
</html>


