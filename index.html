<!DOCTYPE html>
<html lang="de-CH">
<head>
<meta charset="UTF-8">
<title>Teneriffa 2026/2027</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- DataTables Styles -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.colVis.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
<script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin:15px; background:#f2f4f7; font-size:13px; }

h1 {
  margin-bottom: 10px;
  font-size: 18px;
  font-weight: 500;
  color: #2c3e50;
}

.toolbar { margin-bottom:15px; display:flex; flex-wrap:wrap; gap:8px; }

.chip {
  padding:6px 14px;
  border-radius:20px;
  font-size:12px;
  cursor:pointer;
  background:#e3e8ee;
  color:#2c3e50;
  transition:all .2s ease;
}

.chip:hover { background:#d5dde6; }

.chip.active {
  background:#2c3e50;
  color:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

div.dt-buttons {
  display:flex;
  gap:8px;
  margin-bottom:10px;
}

/* Buttons wie Chips */
div.dt-buttons .dt-button {
  padding:6px 14px !important;
  border-radius:20px !important;
  font-size:12px !important;
  background:#e3e8ee !important;
  color:#2c3e50 !important;
  border:none !important;
  box-shadow:none !important;
  transition:all .2s ease !important;
}

div.dt-buttons .dt-button:hover {
  background:#d5dde6 !important;
}

#golfTable tbody td,
#golfTable thead th { text-align:center; }

#golfTable th:nth-child(n+6),
#golfTable td:nth-child(n+6) {
  width:70px;
  min-width:70px;
  max-width:70px;
  font-size:11px;
}

#golfTable th,
#golfTable td { border-right:1px solid #e6eaef; }

#golfTable th:last-child,
#golfTable td:last-child { border-right:none; }

#golfTable tbody td { border-top:1px solid #eef2f6; }

table.dataTable,
table.dataTable tbody td,
table.dataTable thead th { background-color:#ffffff; }

/* sichtbarer Scroll-Header */
.dataTables_scrollHead table thead th {
  background-color: #f4f6f8 !important;   /* dezentes Grau */
  padding: 4px 6px !important;            /* weniger HÃ¶he */
  font-weight: 500;
  line-height: 1.2;
}  

.dtfc-fixed-left,
.dtfc-fixed-left table,
.dtfc-fixed-left thead th,
.dtfc-fixed-left tbody td { background-color:#ffffff !important; }

.dtfc-fixed-left { box-shadow:3px 0 5px rgba(0,0,0,0.04); }
</style>
</head>

<body>

<h1>Teneriffa 2026/2027</h1>

<div class="toolbar">
  <div class="chip active" data-ort="">Alle</div>
  <div class="chip" data-ort="AM">AM</div>
  <div class="chip" data-ort="DS">DS</div>
  <div class="chip" data-ort="AD">AD</div>
  <div class="chip" data-ort="LA">LA</div>
  <div class="chip" data-ort="BV">BV</div>
  <div class="chip" data-ort="RE">RE</div>
</div>

<table id="golfTable" class="display nowrap" style="width:100%">
  <thead></thead>
  <tbody></tbody>
</table>

<script>

const CONFIG = {
  csvUrl: "https://dariolorenzon.github.io/Teneriffa/golfplan.csv",
  delimiter: ";",
  columns: { date:0, ort:1, nameStart:7 }
};

let tableInstance = null;

function parseDate(dateStr){
  const parts = dateStr.split(".");
  return new Date(parts[2], parts[1]-1, parts[0]);
}

function isWeekend(dateStr){
  const day = parseDate(dateStr).getDay();
  return day===0 || day===6;
}

function buildTableHeader(headers){
  return `<tr>${
    headers.map((h,i)=>{
      if(i>=CONFIG.columns.nameStart && h.includes(" ")){
        const [a,b]=h.split(" ");
        return `<th>${a}<br>${b}</th>`;
      }
      return `<th>${h}</th>`;
    }).join("")
  }</tr>`;
}

function initChips(){
  document.querySelectorAll(".chip").forEach(chip=>{
    chip.addEventListener("click",()=>{
      document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      chip.classList.add("active");
      tableInstance.column(CONFIG.columns.ort)
        .search(chip.dataset.ort)
        .draw();
    });
  });
}

function loadCsvData(callback){
  Papa.parse(`${CONFIG.csvUrl}?v=${Date.now()}`,{
    download:true,
    delimiter:CONFIG.delimiter,
    skipEmptyLines:true,
    complete:function(results){
      callback(results.data[0], results.data.slice(1));
    }
  });
}

function initDataTable(headers,data){

  document.querySelector("#golfTable thead").innerHTML =
    buildTableHeader(headers);

  tableInstance = $("#golfTable").DataTable({

    dom:'Brt',
    paging:false,
    searching:true,
    autoWidth:false,

    buttons:[
      {
        extend:'colvis',
        text:'Spalten ein/ausblenden'
      },
      {
        extend:'excelHtml5',
        text:'Excel Export',
        filename:function(){
          const today = new Date();
          const y = today.getFullYear();
          const m = String(today.getMonth()+1).padStart(2,"0");
          const d = String(today.getDate()).padStart(2,"0");
          return `Teneriffa_Export_${y}-${m}-${d}`;
        },
        title:null,
        exportOptions:{
          columns:':visible',
          modifier:{
            search:'applied',
            order:'applied'
          }
        }
      }
    ],

    data:data,
    scrollX:true,
    scrollY:"70vh",
    scrollCollapse:true,
    order:[[CONFIG.columns.date,"asc"]],
    fixedColumns:{ leftColumns:2 },
    fixedHeader:true,

    columnDefs:[
      { targets:[4,5], visible:false },
      {
        targets:CONFIG.columns.date,
        render:function(data,type){
          if(type==="sort") return parseDate(data).getTime();
          return data;
        }
      },
      { targets:"_all", className:"dt-center" },
      {
        targets:index=>index>=CONFIG.columns.nameStart,
        render:function(data,type){
          if(type==="display" && data && data.includes(" ")){
            const [a,b]=data.split(" ");
            return `${a}<br>${b}`;
          }
          return data;
        }
      }
    ],

    createdRow:function(row,rowData){
      if(isWeekend(rowData[CONFIG.columns.date])){
        row.classList.add("weekend");
      }
    }

  });
}

document.addEventListener("DOMContentLoaded",()=>{
  loadCsvData((headers,data)=>{
    initDataTable(headers,data);
    initChips();
  });
});

</script>

</body>
</html>

