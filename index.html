<script>
document.addEventListener("DOMContentLoaded", function () {

  console.log("Seite geladen");

  Papa.parse("golfplan.csv", {
    download: true,
    delimiter: ";",
    skipEmptyLines: true,
    complete: function(results) {

      console.log("CSV geladen", results);

      const rows = results.data;

      if (!rows || rows.length === 0) {
        document.body.innerHTML = "<h2>CSV ist leer oder nicht gefunden</h2>";
        return;
      }

      const headers = rows[0];
      const data = rows.slice(1);

      const table = document.getElementById("golfTable");

      // Header bauen
      let thead = "<tr>";
      headers.forEach(h => thead += `<th>${h}</th>`);
      thead += "</tr>";
      table.querySelector("thead").innerHTML = thead;

      // Body bauen (OHNE DataTables!)
      let tbody = "";
      data.forEach(row => {
        tbody += "<tr>";
        headers.forEach((_, i) => {
          tbody += `<td>${row[i] || ""}</td>`;
        });
        tbody += "</tr>";
      });

      table.querySelector("tbody").innerHTML = tbody;

      console.log("Tabelle roh gebaut");

      // ERST JETZT DataTables aktivieren
      $('#golfTable').DataTable({
        pageLength: 50
      });

      console.log("DataTable gestartet");
    },
    error: function(err) {
      document.body.innerHTML = "<h2>Fehler beim Laden der CSV</h2>";
      console.error(err);
    }
  });

});
</script>
